<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0f172a" id="nav-theme">
    <title>VibeBudget Elite</title>
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100;400;700&display=swap');
        body { transition: background-color 1.2s cubic-bezier(0.4, 0, 0.2, 1); font-family: 'Inter', sans-serif; color: white; margin: 0; overflow-x: hidden; min-height: 100vh; }
        .glass { background: rgba(255, 255, 255, 0.06); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 2rem; }
        .holo-shadow { text-shadow: 0 0 20px rgba(255,255,255,0.3); transition: all 0.5s ease; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .quick-btn { background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.1); transition: all 0.2s; }
        .quick-btn:active { transform: scale(0.9); background: rgba(255,255,255,0.2); }
    </style>
</head>
<body class="flex flex-col items-center justify-start p-6 pt-12 bg-[#0f172a]" id="body-bg">
    <div class="w-full max-w-md space-y-6">
        <div class="text-center space-y-2">
            <div class="flex justify-between items-center mb-6">
                <button onclick="setNewLimit()" class="text-[10px] uppercase tracking-[0.3em] text-white/40 bg-white/5 px-4 py-2 rounded-full">Setup</button>
                <div id="day-badge" class="text-[10px] uppercase tracking-[0.3em] bg-white/10 text-white/60 px-4 py-2 rounded-full tracking-tighter">Tag load...</div>
            </div>
            <div id="remaining" class="text-8xl font-thin tracking-tighter holo-shadow">€0.00</div>
            <div id="daily-vibe" class="text-xs font-light tracking-widest uppercase opacity-60 pt-2">Vibe Check...</div>
        </div>

        <div class="glass p-5 shadow-2xl overflow-hidden border-white/5">
            <canvas id="budgetChart" height="140"></canvas>
        </div>

        <div id="quick-area" class="flex justify-center gap-2 overflow-x-auto no-scrollbar py-2">
            </div>

        <div class="glass p-2 flex items-center gap-2 shadow-inner">
            <input type="number" id="amount" inputmode="decimal" placeholder="Betrag" 
                onkeydown="if(event.key === 'Enter') addExpense()"
                class="flex-1 bg-transparent text-2xl p-4 outline-none border-none text-white font-light placeholder-white/10">
            <button onclick="addExpense()" class="bg-white text-slate-900 w-14 h-14 rounded-2xl font-bold text-3xl active:scale-75 shadow-lg">−</button>
        </div>

        <div class="space-y-4 pt-2">
            <div class="flex justify-between items-center px-2">
                <div class="flex items-center gap-3">
                    <h2 class="text-[10px] uppercase tracking-[0.3em] font-bold opacity-30">Aktivität</h2>
                    <button onclick="undoLast()" class="opacity-30 hover:opacity-100 text-xl">↩</button>
                </div>
                <button onclick="clearHistory()" class="text-[9px] uppercase tracking-widest text-red-400/40">Reset</button>
            </div>
            <div id="history" class="flex gap-3 overflow-x-auto pb-6 no-scrollbar"></div>
        </div>
    </div>

    <script>
        if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js'); }

        const defaultQuick = [{n:"Kaffee", v:3.5}, {n:"Döner", v:7.5}, {n:"Snack", v:2.0}];
        let state = JSON.parse(localStorage.getItem('vibeDataV7') || JSON.stringify({
            limit:200, rem:200, history:[], chartData:[200], startDay: 1, quick: defaultQuick
        })); 
        let chart;

        function initChart() {
            const ctx = document.getElementById('budgetChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: { labels: state.chartData.map((_, i) => i), datasets: [{ data: state.chartData, borderColor: '#fff', borderWidth: 2, tension: 0.4, pointRadius: 0, fill: true, backgroundColor: 'rgba(255,255,255,0.02)' }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false } } }
            });
        }

        function render() {
            const today = new Date().getDay() || 7;
            let daysPassed = (today - state.startDay + 7) % 7 + 1;
            let daysRemaining = 7 - daysPassed + 1;

            document.getElementById('day-badge').innerText = `Tag ${daysPassed} / 7`;
            document.getElementById('remaining').innerText = `€${state.rem.toFixed(2)}`;
            
            const dailyAvailable = Math.max(0, state.rem / daysRemaining);
            document.getElementById('daily-vibe').innerText = `€${dailyAvailable.toFixed(2)} pro Tag verbleibend`;

            // Holo-Glow & Dynamic Colors
            const budgetHealth = state.rem / state.limit;
            let color = "#0f172a", glow = "rgba(255,255,255,0.3)"; 
            if (budgetHealth < 0.2) { color = "#3b0707"; glow = "rgba(239,68,68,0.5)"; }
            else if (budgetHealth < 0.5) { color = "#3a1a02"; glow = "rgba(245,158,11,0.4)"; }
            else if (budgetHealth > 0.8) { color = "#022c22"; glow = "rgba(16,185,129,0.5)"; }
            
            document.getElementById('body-bg').style.backgroundColor = color;
            document.getElementById('remaining').style.textShadow = `0 0 30px ${glow}`;
            document.getElementById('nav-theme').setAttribute("content", color);

            chart.data.labels = state.chartData.map((_, i) => i);
            chart.data.datasets[0].data = state.chartData;
            chart.update();

            // Quick Buttons render
            document.getElementById('quick-area').innerHTML = state.quick.map(q => `
                <button onclick="quickAdd(${q.v})" class="quick-btn px-4 py-2 rounded-full text-[10px] uppercase tracking-widest text-white/70 whitespace-nowrap">
                    ${q.n} €${q.v.toFixed(2)}
                </button>
            `).join('');

            document.getElementById('history').innerHTML = state.history.map((item, index) => `
                <div onclick="deleteEntry(${index})" class="glass min-w-[110px] p-4 text-center active:bg-white/10">
                    <div class="text-[7px] opacity-30 mb-1">${item.date}</div>
                    <div class="font-bold text-base text-white">€${item.amount.toFixed(2)}</div>
                </div>
            `).join('') || '<div class="opacity-10 text-[10px] p-4 uppercase">Keine Daten</div>';

            localStorage.setItem('vibeDataV7', JSON.stringify(state));
        }

        function quickAdd(val) {
            document.getElementById('amount').value = val;
            addExpense();
        }

        function addExpense() {
            const input = document.getElementById('amount');
            const val = parseFloat(input.value);
            if (val > 0) {
                if (navigator.vibrate) navigator.vibrate(25); 
                state.rem -= val;
                state.chartData.push(state.rem);
                state.history.unshift({ amount: val, date: new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}) });
                input.value = '';
                render();
            }
        }

        function undoLast() {
            if (state.history.length > 0) {
                const last = state.history.shift();
                state.rem += last.amount;
                state.chartData.pop();
                render();
            }
        }

        function deleteEntry(index) {
            if(confirm("Löschen?")) {
                state.rem += state.history[index].amount;
                state.history.splice(index, 1);
                recalculateChart();
                render();
            }
        }

        function recalculateChart() {
            let current = state.limit;
            let newData = [current];
            [...state.history].reverse().forEach(item => { current -= item.amount; newData.push(current); });
            state.chartData = newData; state.rem = current;
        }

        function setNewLimit() {
            const newLim = prompt("Limit?", state.limit);
            const newDay = prompt("Starttag (1-7)?", state.startDay);
            const qStr = prompt("Quick-Buttons (Name,Preis;Name,Preis...)?", state.quick.map(q => `${q.n},${q.v}`).join(';'));
            
            if (newLim) {
                state.limit = parseFloat(newLim);
                state.rem = state.limit;
                state.startDay = parseInt(newDay) || 1;
                if(qStr) state.quick = qStr.split(';').map(s => { const p = s.split(','); return {n:p[0], v:parseFloat(p[1])} });
                state.chartData = [state.limit];
                state.history = [];
                render();
            }
        }

        window.onload = () => { initChart(); render(); };
    </script>
</body>
</html>
