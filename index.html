<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0f172a">
    <title>VibeBudget Elite</title>
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100;300;400;700&display=swap');
        body { background-color: #0f172a; font-family: 'Inter', sans-serif; color: white; margin: 0; overflow-x: hidden; }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 2.5rem; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div class="w-full max-w-md space-y-6">
        <div class="text-center">
            <div class="flex justify-between items-center px-4 mb-4">
                <button onclick="setNewLimit()" class="text-[10px] uppercase tracking-[0.3em] text-slate-400 hover:text-white bg-white/5 px-3 py-1 rounded-full">Limit</button>
                <button onclick="exportCSV()" class="text-[10px] uppercase tracking-[0.3em] text-slate-400 hover:text-emerald-400 bg-white/5 px-3 py-1 rounded-full">Export</button>
            </div>
            <div id="remaining" class="text-7xl font-thin tracking-tighter drop-shadow-2xl">€0.00</div>
            <div id="daily-vibe" class="mt-3 text-xs font-light tracking-widest uppercase opacity-80 text-emerald-300">Berechne...</div>
        </div>
        <div class="glass p-5"><canvas id="budgetChart" height="180"></canvas></div>
        <div class="glass p-2 flex items-center gap-2 pr-2">
            <input type="number" id="amount" inputmode="decimal" placeholder="0.00" class="flex-1 bg-transparent text-2xl p-4 outline-none text-white font-light">
            <button onclick="addExpense()" class="bg-emerald-500 text-slate-900 w-14 h-14 rounded-2xl font-bold text-3xl active:scale-75 shadow-lg">−</button>
        </div>
        <div class="space-y-4">
            <div class="flex justify-between items-center px-4 text-slate-500">
                <h2 class="text-[10px] uppercase tracking-[0.2em] font-bold">Aktivität</h2>
                <button onclick="clearHistory()" class="text-[10px] uppercase tracking-widest hover:text-red-400">Reset</button>
            </div>
            <div id="history" class="flex gap-4 overflow-x-auto p-2 no-scrollbar"></div>
        </div>
    </div>
    <script>
        if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js'); }
        let state = JSON.parse(localStorage.getItem('vibeBudgetData') || '{"limit":200,"remaining":200,"history":[],"chartData":[200]}');
        let chart;
        function initChart() {
            const ctx = document.getElementById('budgetChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: { labels: state.chartData.map((_, i) => i), datasets: [{ data: state.chartData, borderColor: '#ffffff', borderWidth: 4, tension: 0.4, pointRadius: 0, fill: true, backgroundColor: 'rgba(255,255,255,0.05)' }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false } } }
            });
        }
        function render() {
            document.getElementById('remaining').innerText = `€${state.remaining.toFixed(2)}`;
            const daysLeft = 8 - (new Date().getDay() || 7);
            document.getElementById('daily-vibe').innerText = `€${Math.max(0, state.remaining / daysLeft).toFixed(2)} pro Tag verfügbar`;
            chart.data.labels = state.chartData.map((_, i) => i);
            chart.data.datasets[0].data = state.chartData;
            chart.update();
            document.getElementById('history').innerHTML = state.history.map(item => `<div class="glass min-w-[140px] p-4 text-center"><div class="text-[9px] text-slate-500 mb-1">${item.date}</div><div class="font-bold text-xl">€${item.amount.toFixed(2)}</div></div>`).join('');
            localStorage.setItem('vibeBudgetData', JSON.stringify(state));
        }
        function addExpense() {
            const input = document.getElementById('amount');
            const val = parseFloat(input.value);
            if (val > 0) {
                state.remaining -= val;
                state.chartData.push(state.remaining);
                state.history.unshift({ amount: val, date: new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}) });
                input.value = '';
                render();
            }
        }
        function setNewLimit() {
            const val = prompt("Neues Limit?", state.limit);
            if (val) { state.limit = parseFloat(val); state.remaining = state.limit; state.chartData = [state.limit]; state.history = []; render(); }
        }
        function clearHistory() { if(confirm("Reset?")) { state.remaining = state.limit; state.chartData = [state.limit]; state.history = []; render(); } }
        function exportCSV() {
            let csv = "Zeit,Betrag\n" + state.history.map(i => `${i.date},${i.amount}`).join("\n");
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = 'VibeBudget.csv'; a.click();
        }
        window.onload = () => { initChart(); render(); };
    </script>
</body>
</html>
