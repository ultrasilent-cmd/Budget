<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0f172a" id="nav-theme">
    <title>VibeBudget Elite</title>
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100;300;400;700&display=swap');
        body { transition: background-color 1.2s ease; font-family: 'Inter', sans-serif; color: white; margin: 0; overflow-x: hidden; min-height: 100vh; }
        .glass { background: rgba(255, 255, 255, 0.06); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 2.5rem; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="flex flex-col items-center justify-start p-6 pt-12 bg-[#0f172a]" id="body-bg">
    <div class="w-full max-w-md space-y-8">
        <div class="text-center space-y-2">
            <div class="flex justify-between items-center mb-8">
                <button onclick="setNewLimit()" class="text-[10px] uppercase tracking-[0.3em] text-white/40 hover:text-white bg-white/5 px-4 py-2 rounded-full transition-all">Setup</button>
                <div id="day-badge" class="text-[10px] uppercase tracking-[0.3em] bg-white/10 text-white/60 px-4 py-2 rounded-full">Tag geladen...</div>
            </div>
            <div id="remaining" class="text-8xl font-thin tracking-tighter drop-shadow-2xl transition-all">€0.00</div>
            <div id="daily-vibe" class="text-xs font-light tracking-widest uppercase opacity-60">Vibe Check...</div>
        </div>

        <div class="glass p-6 shadow-2xl overflow-hidden">
            <canvas id="budgetChart" height="160"></canvas>
        </div>

        <div class="glass p-2 flex items-center gap-2">
            <input type="number" id="amount" inputmode="decimal" placeholder="Betrag" 
                onkeydown="if(event.key === 'Enter') addExpense()"
                class="flex-1 bg-transparent text-2xl p-4 outline-none border-none text-white font-light placeholder-white/20">
            <button onclick="addExpense()" id="add-btn"
                class="bg-white text-slate-900 w-14 h-14 rounded-2xl font-bold text-3xl flex items-center justify-center active:scale-75 transition-all shadow-lg">
                −
            </button>
        </div>

        <div class="space-y-4">
            <div class="flex justify-between items-center px-2">
                <h2 class="text-[10px] uppercase tracking-[0.3em] font-bold opacity-40">Aktivität</h2>
                <button onclick="clearHistory()" class="text-[9px] uppercase tracking-widest text-red-400/50 hover:text-red-400">Reset</button>
            </div>
            <div id="history" class="flex gap-4 overflow-x-auto pb-4 no-scrollbar"></div>
        </div>
    </div>

    <script>
        if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js'); }

        let state = JSON.parse(localStorage.getItem('vibeDataV5') || '{"limit":200,"rem":200,"history":[],"chartData":[200], "startDay": 1}'); 
        let chart;

        function initChart() {
            const ctx = document.getElementById('budgetChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: { 
                    labels: state.chartData.map((_, i) => i), 
                    datasets: [{ 
                        data: state.chartData, 
                        borderColor: '#ffffff', 
                        borderWidth: 3, 
                        tension: 0.4, 
                        pointRadius: 0, 
                        fill: true, 
                        backgroundColor: 'rgba(255,255,255,0.03)' 
                    }] 
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false } } }
            });
        }

        function render() {
            const today = new Date().getDay() || 7;
            let daysPassed = (today - state.startDay + 7) % 7 + 1;
            let daysRemaining = 7 - daysPassed + 1;

            document.getElementById('day-badge').innerText = `Tag ${daysPassed} / 7`;
            document.getElementById('remaining').innerText = `€${state.rem.toFixed(2)}`;
            
            const dailyAvailable = Math.max(0, state.rem / daysRemaining);
            document.getElementById('daily-vibe').innerText = `€${dailyAvailable.toFixed(2)} pro Tag verbleibend`;

            const budgetHealth = state.rem / state.limit;
            let color = "#0f172a"; 
            if (budgetHealth < 0.2) color = "#450a0a"; 
            else if (budgetHealth < 0.5) color = "#451a03"; 
            else if (budgetHealth > 0.8) color = "#064e3b"; 
            
            document.getElementById('body-bg').style.backgroundColor = color;
            document.getElementById('nav-theme').setAttribute("content", color);

            chart.data.labels = state.chartData.map((_, i) => i);
            chart.data.datasets[0].data = state.chartData;
            chart.update();

            document.getElementById('history').innerHTML = state.history.map(item => `
                <div class="glass min-w-[120px] p-4 text-center">
                    <div class="text-[8px] opacity-40 mb-1">${item.date}</div>
                    <div class="font-bold text-lg text-white">€${item.amount.toFixed(2)}</div>
                </div>
            `).join('') || '<div class="opacity-20 text-[10px] p-4 uppercase">Keine Daten</div>';

            localStorage.setItem('vibeDataV5', JSON.stringify(state));
        }

        function addExpense() {
            const input = document.getElementById('amount');
            const val = parseFloat(input.value);
            if (val > 0) {
                if (navigator.vibrate) navigator.vibrate(30); 
                state.rem -= val;
                state.chartData.push(state.rem);
                state.history.unshift({ amount: val, date: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) });
                input.value = '';
                // Fokus behalten für schnelle Eingaben
                input.focus();
                render();
            }
        }

        function setNewLimit() {
            const newLim = prompt("Neues Wochen-Limit?", state.limit);
            const newDay = prompt("Wochenstart (1=Mo, 7=So)?", state.startDay);
            if (newLim) {
                state.limit = parseFloat(newLim);
                state.rem = state.limit;
                state.startDay = parseInt(newDay) || 1;
                state.chartData = [state.limit];
                state.history = [];
                render();
            }
        }

        function clearHistory() { 
            if(confirm("Woche neu starten?")) { 
                state.rem = state.limit; 
                state.chartData = [state.limit]; 
                state.history = []; 
                render(); 
            } 
        }

        window.onload = () => { initChart(); render(); };
    </script>
</body>
</html>
